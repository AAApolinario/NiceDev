$(document).ready(function(){read_login(),Initialize(),cti.init()});var strPauseReason,strMatrizTransf,pageOnAccounts,OpenCTIOnCall,currentCreatedTaskId,startDate,endDate,stragentName,reqScreenpopupAccount,reqScreenpopupTask,reqScreenpopupCase,reqScreenpopupLead,reqScreenpopupField,reqPageOnNoAccounts,reqLayoutUUI,reqCTIConfigAES,reqCTIConfigAESPort,reqCTIConfigAESUser,reqCTIConfigAESPassword,reqCTIConfigCM,reqCTIConfigCMName,reqCTIConfigWS,reqOpenCtiOnCall,reqSoftphoneHeight,api=new getBettaCTIAPI,callconnected=!1,strpositivacao="",startpositivacao=!1,startmakecall=!1,blnscreenpop=!1,strhtmluui="",intHeight=520,strPause="",clickToDialEnabled=!1,reqPauseReasons=[],reqDestinations=[],reqCTIConfigPrefix="",timer=new easytimer.Timer,callback=function(a){a.success||console.error("Something went wrong! Errors:",a.errors)};class SForceLightingCTI{constructor(){var a=this;a.searchPromise=new Promise(function(a,b){});var b=!1}init(){var a=this;a.contactPromise=new Promise(function(a,b){}),a.servicePrefixPromise=new Promise(function(a,b){}),sforce.opencti.setSoftphonePanelVisibility({visible:!0,callback:function(){a._init()}})}enableClickToDial(){var a=this;a.clickToDialEnabled=!0,sforce.opencti.enableClickToDial({callback:function(a){a.success||console.error("SFORCE","Something went wrong! Errors:",a.errors)}}),sforce.opencti.onClickToDial({listener:function(c){"Task"!=c.objectType&&(a.clickToDialObject=c.recordId),"true"==a.OpenCTIOnCall&&a.show();var b=c.number;b=(b=(b=(b=(b=(b=b.replace("+","")).replace("55","")).replace(" ","")).replace("(","")).replace(")","")).replace("-",""),api.makecall(reqCTIConfigPrefix+b)}})}disableClickToDial(){self.clickToDialEnabled=!1,sforce.opencti.disableClickToDial({callback:function(a){a.success||console.error("SFORCE","Something went wrong! Errors:",a.errors)}})}_init(){var b=this;b.initiated=!0,"true"==b.OpenCTIOnCall&&b.show();var a=function(a){if(a.success){reqPageOnNoAccounts=a.returnValue["/reqScreenpopupOptions/reqPageOnNoAccounts"],OpenCTIOnCall=a.returnValue["/reqCTIConfig/reqOpenCtiOnCall"],reqScreenpopupAccount=a.returnValue["/reqScreenpopupOptions/reqScreenpopupAccount"],reqScreenpopupTask=a.returnValue["/reqScreenpopupOptions/reqScreenpopupTask"],reqScreenpopupCase=a.returnValue["/reqScreenpopupOptions/reqScreenpopupCase"],reqScreenpopupLead=a.returnValue["/reqScreenpopupOptions/reqScreenpopupLead"],reqScreenpopupField=a.returnValue["/reqScreenpopupOptions/reqScreenpopupField"],reqLayoutUUI=a.returnValue["/reqScreenpopupOptions/reqLayoutUUI"];var c,b=0;for(b=0;b<10;b++)window["reqPauseReason"+b]=new Object,window["reqPauseReason"+b].reason=a.returnValue["/reqPauseReasons/reqPauseReason"+b],window["reqPauseReason"+b].id=b,window["reqPauseReason"+b].reason&&reqPauseReasons.push(window["reqPauseReason"+b]);var d="";for(b=0;b<13;b++)window["reqDestination"+b]=new Object,(d=a.returnValue["/reqDestionations/reqDestination"+b])&&(c=d.split("|")).length>=0&&(window["reqDestination"+b].id=c[0],window["reqDestination"+b].destino=c[1],reqDestinations.push(window["reqDestination"+b]));reqCTIConfigAES=a.returnValue["/reqCTIConfig/reqCTIConfigAES"],reqCTIConfigAESPort=a.returnValue["/reqCTIConfig/reqCTIConfigAESPort"],reqCTIConfigAESUser=a.returnValue["/reqCTIConfig/reqCTIConfigAESUser"],reqCTIConfigAESPassword=a.returnValue["/reqCTIConfig/reqCTIConfigAESPassword"],reqCTIConfigCM=a.returnValue["/reqCTIConfig/reqCTIConfigCM"],reqCTIConfigCMName=a.returnValue["/reqCTIConfig/reqCTIConfigCMName"],reqCTIConfigWS=a.returnValue["/reqCTIConfig/reqCTIConfigWS"];var e=a.returnValue["/reqCTIConfig/reqCTIConfigPrefix"];e&&(reqCTIConfigPrefix=a.returnValue["/reqCTIConfig/reqCTIConfigPrefix"]),reqSoftphoneHeight=a.returnValue["/reqGeneralInfo/reqSoftphoneHeight"]}else console.error("Something went wrong! Errors:",a.errors)};sforce.opencti.getCallCenterSettings({callback:a});var a=function(a){};sforce.opencti.setSoftphonePanelLabel({label:"Betta",callback:a}),sforce.opencti.setSoftphonePanelIcon({key:"incoming_call",callback:a})}SetStatus(a){sforce.console.presence.setServicePresenceStatus(a,function(a){a.success?(console.log("Set status successful"),console.log("Current statusId is: "+a.statusId),console.log("Channel list attached to this status is: "+a.channels)):console.error("Set status failed")})}ScreenPopUp(c){if(c.hasOwnProperty("UserData")){sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.NEW_RECORD_MODAL,params:{entityName:"Task",defaultFieldValues:{Description:"Session:"+c.UserData.dados.Session+" ContactId:"+c.UserData.dados.ContactId}},callback:callback});return}var i,j=c.UCID,f=c.UUI,k=c.ANI,l="",m="",n=!1,h="";if(reqLayoutUUI&&reqScreenpopupField)try{for(var d=reqLayoutUUI.split("|"),g=0,b=0;b<d.length;b++)d[b]==reqScreenpopupField&&(g=b);var e=f.split(";");e.length>0&&(h=e[g]),strhtmluui="<table>";for(var b=0;b<d.length;b++){var a=e[b];0==b&&("1"==a&&(a="Cons\xf3rcio"),"2"==a&&(a="CDC"),"3"==a&&(a="Leasing"),"4"==a&&(a="Finame"),"5"==a&&(a="Finame Leasing")),strhtmluui+="<tr><td>"+d[b]+"</td>",strhtmluui+="<td>"+a+"</td></tr>"}strhtmluui+="</table>"}catch{console.log("Error",reqLayoutUUI,reqScreenpopupField,f)}self.searchPromise=new Promise(function(a,b){sforce.opencti.searchAndScreenPop({searchParams:h,queryParams:"",callType:sforce.opencti.CALL_TYPE.INBOUND,deferred:!0,defaultFieldValues:{CpfCnpj__c:h},callback:function(c){if(c.success){var d=c.returnValue,e="",f=!1;try{for(var h in d){var g=d[h];"Account"==g.RecordType&&(e=g.Id,f=!0)}}catch{}if(m=e,f){if(n=!0,a(c),"Y"==reqScreenpopupAccount&&sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.SOBJECT,params:{recordId:m}}),"Y"==reqScreenpopupCase){var l={entityApiName:"Case",Priority:"Medium",Status:"New",AccountId:m,SuppliedPhone:k};sforce.opencti.saveLog({value:l,callback:function(a){if(a.success){if(sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.SOBJECT,params:{recordId:a.returnValue.recordId}}),"Y"==reqScreenpopupTask){i=a.returnValue.recordId;var b={entityApiName:"Task",CallObject:j,Subject:"Chamada: "+k+" ("+startDate.toLocaleString()+")",Priority:"Normal",Status:"Open",TaskSubtype:"Call",WhatId:i};sforce.opencti.saveLog({value:b,callback:function(a){a.success&&(currentCreatedTaskId=a.returnValue.recordId)}})}}else console.error("Something went wrong! Errors:",a.errors)}})}}else"Y"==reqScreenpopupAccount&&sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.URL,params:{url:reqPageOnNoAccounts}})}else console.error("SFORCE CNPJ","sforce.opencti.searchAndScreenPop: Something went wrong! Errors:",c),b(c)}})}),self.searchPromise=new Promise(function(b,c){var a={entityApiName:"Task",CallObject:j,Subject:"Chamada: "+k+" ("+startDate.toLocaleString()+")",Priority:"Normal",Status:"Open",TaskSubtype:"Call"};l.length>0?a.WhatId=l:(a.WhatId=m,l=m),"Y"==reqScreenpopupTask&&"Y"!=reqScreenpopupCase&&sforce.opencti.saveLog({value:a,callback:function(b){if(b.success)"Y"==reqScreenpopupAccount?sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.SOBJECT,params:{recordId:a.WhatId}}):sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.SOBJECT,params:{recordId:b.returnValue.recordId}}),currentCreatedTaskId=b.returnValue.recordId;else{var c=b.errors;c.length>0&&c[0].details.fieldErrors.WhatId.length>0&&(a.WhatId="",sforce.opencti.searchAndScreenPop({searchParams:k,queryParams:"",callType:sforce.opencti.CALL_TYPE.INBOUND,deferred:!0,defaultFieldValues:{Phone:k},callback:function(b){if(b.success){var c=b.returnValue;for(var j in c){var d,e,f=c[j];for(var g in f){var h=g,i=f[g];"Id"==h&&(e=i),"RecordType"==h&&"Account"==i&&(d=e)}}m=d,n=!0,a.WhatId=m,sforce.opencti.saveLog({value:a,callback:function(b){if(b.success)"Y"==reqScreenpopupAccount?m?sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.SOBJECT,params:{recordId:m}}):sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.URL,params:{url:reqPageOnNoAccounts}}):sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.SOBJECT,params:{recordId:b.returnValue.recordId}}),currentCreatedTaskId=b.returnValue.recordId;else{var c=b.errors;c.length>0&&c[0].details.fieldErrors.WhatId.length>0&&(a.WhatId="",sforce.opencti.saveLog({value:a,callback:function(a){a.success&&(sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.SOBJECT,params:{recordId:a.returnValue.recordId}}),api.acrsendtag(a.returnValue.recordId),currentCreatedTaskId=a.returnValue.recordId)}})),"Y"==reqScreenpopupAccount&&sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.URL,params:{url:reqPageOnNoAccounts}})}}})}else console.error("SFORCE","sforce.opencti.searchAndScreenPop: Something went wrong! Errors:",b),a.WhatId="",sforce.opencti.saveLog({value:a,callback:function(a){a.success&&(sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.SOBJECT,params:{recordId:a.returnValue.recordId}}),api.acrsendtag(a.returnValue.recordId),currentCreatedTaskId=a.returnValue.recordId)}}),"Y"==reqScreenpopupAccount&&sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.URL,params:{url:reqPageOnNoAccounts}})}}))}}})})}UpdateTask(b){if("Y"==reqScreenpopupTask){var a=this;a.endDate=new Date;var c=(a.endDate-startDate)/1e3;sforce.opencti.saveLog({value:{Id:b,CallDurationInSeconds:c,Status:"Completed"},callback:function(a){a.success?sforce.opencti.refreshView():(sforce.opencti.refreshView(),console.error("Something went wrong! Errors:",a.errors))}})}}}var cti=new SForceLightingCTI;function Initialize(){$("#frmDados").hide(),$("#BT_LOGOUT").hide(),$("#BT_READY").hide(),$("#BT_PAUSE").hide(),$("#pausereason").hide(),$("#BtAnswerCall").hide(),$("#BtConference").hide(),$("#BtDial").hide(),$("#BtHangup").hide(),$("#BtHold").hide(),$("#BtRetrieve").hide(),$("#BtTransfer").hide(),$("#BtTransferOff").hide(),$("#BtConferenceOff").hide(),$("#BtWrapup").hide(),$("#TXT_AGENT_DISPLAY").val("Deslogado"),$("#TXT_AGENT_DISPLAY").hide(),$("#BtPositivacao").hide(),$("#TXT_AGENT_PASSWORD").hide(),$("#BtDialoff").hide(),$("#BtDial").hide(),$("#cti-attendance").hide(),$("#pausa-on").hide(),$("#pausa-off").hide(),$("#tempochamada").hide(),$("#TXT_MESSAGES").hide(),$("#TXT_AGENT_NAME").val(""),$("#TXT_AGENT_NAME").hide(),$("#pausegrp").hide(),$("#TXT_STATUS").hide(),$("#desligado").hide(),$("#status_phone").hide(),$("#toolbar_phone").hide(),$("#status_omni").hide(),$("#cliente-off").show(),$("#questions_and_answers_off").hide(),$("#questions_and_answers_on").hide(),stragentName="",seltransf="",selreason=""}function ToMakeCall(){document.getElementById("seltransf")}function CancelMakeCall(){$("#frmDados").show()}function colocarEmEspera(){api.hold()}function sairDeEspera(){api.retrieve()}function Identity(){sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.FLOW,params:{flowDevName:"POC_CTI",flowArgs:[{name:"teste",type:"String",value:"Tudo certo"},{name:"origem",type:"String",value:"SAC"}]}})}function Log(a,b,c){console.log(b+" - "+a+" - "+c)}function ConfigCTI(){var a=new Object;a.type="configcti",a.aesip=reqCTIConfigAES,a.aesport=reqCTIConfigAESPort,a.aeslogin=reqCTIConfigAESUser,a.aespassword=reqCTIConfigAESPassword,a.cm=reqCTIConfigCM,a.cm_name=reqCTIConfigCMName,a.server=reqCTIConfigWS,a.PauseReasons=reqPauseReasons,a.MatrizTransf=reqDestinations,a.ProductKey="gKKufyCWHLQ4yEfZ/95tPaqUgUrdPBmT81Sp4uVJ57qciuHNamdFuFB/IyOW/RimLOzWmnGbudwvWFivIMiQqg==",a.CallbackActive="False",a.CallbackShortcall="10",a.CallbackAutomatic="False",a.CallbackTimeOut="30",a.CallbackPrefix="00",a.CallbackTries="4",api.configcti(a,a.server)}function Login(){$("#TXT_MESSAGES").val("");var a=new Object;a.type="login",a.extension=$("#TXT_AGENT_EXTENSION").val(),a.agent=$("#TXT_AGENT").val(),a.password=$("#TXT_AGENT_PASSWORD").val(),reqCTIConfigWS||(reqCTIConfigWS="wss://old.c2x.com.br/BettaCTIWeb/bettacti.svc?Instance=avaya"),a.server=reqCTIConfigWS,api.login(a.agent,a.password,a.extension,a.server),validate_login()}function Logout(){$("#TXT_MESSAGES").hide(),$("#TXT_AGENT_NAME").val(""),stragentName="",$("#BtDial").hide(),$("#BtTransfer").hide(),$("#BtTransferOff").hide(),$("#BtConference").hide(),$("#BtConferenceOff").hide(),$("#BT_LOGIN").removeClass("slds-button_text-destructive").addClass("slds-button_brand"),$("#BT_LOGIN").removeAttr("title"),api.logout(),validate_logout()}function Ready(){api.ready()}function Pause(){var a=document.getElementById("selreason");100==a.value?api.ready():api.pause(a.value),$("#modalPause").modal("hide")}function MatrizTranf(){$("#modalMakeCall").modal("hide"),$("#frmDados").show();var a=document.getElementById("seltransf");!0==callconnected?api.consultationcall(a.value):api.makecall(a.value),$("#seltransf").val("")}function PauseReason(){}function CreateModalDiv(c,d){var a=document.getElementById(c);if(a)a.innerHTML="";else{(a=document.createElement("div")).id=c,a.className="PanelModal",a.style.left=d.clientX+"px",a.style.top=d.clientY+"px",document.body.appendChild(a);var b=document.createElement("div");b.id=c+"_OVERLAY",b.className="PanelModalOverlay",b.innerHTML="&nbsp;",document.body.appendChild(b)}}function ClosePauseDiv(c){var a=document.getElementById("DIV_PAUSE_OVERLAY");a&&a.parentNode.removeChild(a);var b=document.getElementById("DIV_PAUSE");b&&b.parentNode.removeChild(b)}function CloseCampaignDiv(c){var a=document.getElementById("DIV_CAMPAIGN_OVERLAY");a&&a.parentNode.removeChild(a);var b=document.getElementById("DIV_CAMPAIGN");b&&b.parentNode.removeChild(b)}function CloseCallDiv(c){var a=document.getElementById("DIV_CALL_OVERLAY");a&&a.parentNode.removeChild(a);var b=document.getElementById("DIV_CALL");b&&b.parentNode.removeChild(b)}function CloseStatusDiv(){var a=document.getElementById("DIV_STATUS_OVERLAY");a&&a.parentNode.removeChild(a);var b=document.getElementById("DIV_STATUS");b&&b.parentNode.removeChild(b)}function OnMakeCallClick(h){CreateModalDiv("DIV_CALL",h);var i=document.getElementById("DIV_CALL"),c=document.createElement("table");c.style.width="100%",c.style.paddingBottom="2px";var b=c.insertRow(-1),a=b.insertCell(-1);a.colSpan=2,a.innerHTML="Manual call",a.className="TdTitle";var b=c.insertRow(-1),a=b.insertCell(-1);a.innerHTML="Phone&nbsp;:&nbsp;",a.colSpan=2,a.style.textAlign="center";var d=document.createElement("input");d.type="text",d.className="form-control",d.style.width="120px",d.id="INPUT_CALL",a.appendChild(d);var b=c.insertRow(-1),a=b.insertCell(-1);a.innerHTML="Campaign&nbsp;:&nbsp;",a.colSpan=2,a.style.textAlign="center";var g=document.createElement("select");g.style.width="120px",g.id="SELECT_CALL",a.appendChild(g);var b=c.insertRow(-1),a=b.insertCell(-1);a.style.textAlign="center";var e=document.createElement("button");e.innerHTML="<span class='glyphicon glyphicon-earphone' aria-hidden='true'></span> Call",e.className="btn btn-success",e.onclick=MakeCall,a.appendChild(e);var a=b.insertCell(-1);a.style.textAlign="center";var f=document.createElement("button");f.className="btn btn-danger",f.innerHTML="<span class='glyphicon glyphicon-remove' aria-hidden='true'></span> Cancel",f.onclick=CloseCallDiv,a.appendChild(f),i.appendChild(c)}function MakeCall(b){var a=document.getElementById("INPUT_CALL").value;!0==callconnected?api.consultationcall(a):api.makecall(a)}function OnAnswerCall(){}function OnHangupClick(a){api.hangup()}function OnHoldClick(a){api.hold()}function OnRetrieveClick(a){api.retrieve()}function OnTransferClick(a){api.transfer()}function OnConferenceClick(a){api.conference()}function OnWrapupClick(a){api.ready()}function PopulateSubStatus(j){for(var f=parseInt(document.getElementById("SELECT_STATUS_CODE").value,10),b=document.getElementById("SELECT_SUB_STATUS"),a=b.options.length-1;a>=0;a--)b.remove(a);if(-1!=f)for(var h=agentlink.Telephony.GetSession(),g=agentlink.QualificationCodes(h.QualificationGroup),a=0;a<g.Count;a++){var c=g.Item(a);if(c.Code==f){for(var d=0;d<c.Details.Count;d++){var e=c.Details.Item(d),i=new Option(e.Code+" -"+e.Description,e.Code);b.add(i),b.disabled=!1}0==c.Details.Count&&(b.disabled=!0)}}else b.disabled=!0}function LZ(a){return(a<0||a>9?"":"0")+a}$(".hover-active.pausa-on").on("click",function(){PauseReason()}),$("#TXT_AGENT_EXTENSION").keypress(function(a){13==a.which&&Login()}),api.CSTAErrorCode=function(a){$("#BT_LOGIN").removeClass("slds-button_brand").addClass("slds-button_text-destructive"),$("#BT_LOGIN").attr("title","Error no Login")},api.OnAgentLogged=function(a){$("#TXT_MESSAGES").val(""),$("#TXT_MESSAGES").hide()},api.onBettaDriverOpen=function(a){$("#BT_LOGIN").prop("disabled",!1),read_login()},api.onBettaDriverClose=function(a){Logout(),$("#BT_LOGIN").prop("disabled",!0)},api.onBettaDriverError=function(a){console.log(a.type)},api.OnConnectionCleared=function(a){document.getElementById("CallPhoneNumberValue").innerHTML="",sforce.opencti.setSoftphonePanelHeight({heightPX:reqSoftphoneHeight,callback:callback}),$("#call-duration-count").html("00:00:00"),$("#BT_LOGOUT").prop("disabled",!1)},api.OnOriginated=function(a){$("#frmDados").show(),callconnected=!0,startmakecall=!1,document.getElementById("CallPhoneNumberValue").innerHTML=a.ANI,sforce.opencti.setSoftphonePanelHeight({heightPX:intHeight,callback:callback}),a.UUI&&(document.getElementById("CallCampaignValue").innerHTML=strhtmluui),$("#cti-attendance").show(),$("#tempochamada").show(),$("#cliente-off").hide(),$("#call-duration-count").show(),timer.start(),timer.addEventListener("secondsUpdated",function(a){$("#call-duration-count").html(timer.getTimeValues().toString())}),timer.addEventListener("started",function(a){$("#call-duration-count").html(timer.getTimeValues().toString())})},api.OnDelivered=function(a){startDate=new Date,$("#frmDados").show(),callconnected=!0,startmakecall=!1,a.hasOwnProperty("ANI")&&(document.getElementById("CallPhoneNumberValue").innerHTML=a.ANI),timer.stop(),timer.start(),$("#call-duration-count").show(),timer.addEventListener("secondsUpdated",function(a){$("#call-duration-count").html(timer.getTimeValues().toString())}),timer.addEventListener("started",function(a){$("#call-duration-count").html(timer.getTimeValues().toString())}),$("#cti-attendance").show(),$("#tempochamada").show(),$("#cliente-off").hide(),blnscreenpop||cti.ScreenPopUp(a),a.hasOwnProperty("UUI")&&(document.getElementById("CallCampaignValue").innerHTML=strhtmluui),blnscreenpop=!0},api.OnEstablished=function(a){$("#frmDados").show(),a.ANI&&(document.getElementById("CallPhoneNumberValue").innerHTML=a.ANI),a.UUI&&(document.getElementById("CallCampaignValue").innerHTML=strhtmluui),callconnected=!0,$("#cti-attendance").show(),$("#cliente-off").hide(),$("#tempochamada").show()},api.OnConsultationCall=function(a){!0==startpositivacao&&(api.conference(),startpositivacao=!1),startmakecall=!0},api.onCallDisconnected=function(a){$("#messages").append($("<li>").text(a.type)),callconnected=!1,startpositivacao=!1},api.OnConnectionCleared=function(a){$("#messages").append($("<li>").text(a.type)),callconnected=!1,startpositivacao=!1,blnscreenpop&&cti.UpdateTask(currentCreatedTaskId),blnscreenpop=!1,timer.stop(),$("#call-duration-count").html("00:00:00"),$("#call-duration-count").hide()},api.OnGetAgentState=function(a){if("True"==a.loggedOnState)$("#loginblock").hide(),$("#frmDados").show(),$("#TXT_MESSAGES").val(""),$("#TXT_MESSAGES").hide(),isLogin=!0,$("#TXT_AGENT_DISPLAY").show(),$("#pausegrp").show(),$("#LBL_LOGIN").hide(),$("#TXT_AGENT").hide(),$("#TXT_AGENT_PASSWORD").hide(),$("#TXT_AGENT_EXTENSION").hide(),$("#TXT_MESSAGES").val(""),$("#TXT_MESSAGES").hide(),$("#TXT_STATUS").show(),isLogin=!0,$("#TXT_AGENT_DISPLAY").show(),$("#pausegrp").show(),$("#LBL_LOGIN").hide(),$("#TXT_AGENT_EXTENSION_DISPLAY").html("Ramal: "+$("#TXT_AGENT_EXTENSION").val()),$("#TXT_AGENT_EXTENSION_DISPLAY").show(),$("#TXT_AGENT_EXTENSION_DISPLAY").html("Ramal: "+$("#TXT_AGENT_EXTENSION").val()),$("#TXT_AGENT_EXTENSION_DISPLAY").show(),$("#status_phone").show(),$("#toolbar_phone").show(),$("#status_omni").show(),$("#cliente-off").hide(),$("#TXT_AGENT_NAME").show(),cti.enableClickToDial();else{$("#TXT_AGENT").show(),$("#TXT_AGENT_PASSWORD").show(),$("#TXT_AGENT_EXTENSION").show(),$("#TXT_AGENT_NAME").val(""),$("#pausereason").hide(),$("#TXT_AGENT_DISPLAY").hide(),$("#TXT_STATUS").hide(),$("#LBL_LOGIN").show(),isLogin=!1,$("#pausegrp").hide(),$("#TXT_AGENT_EXTENSION_DISPLAY").hide(),$("#BT_LOGIN").prop("disabled",!1),$("#BT_LOGIN").show(),Initialize(),cti.disableClickToDial();return}stragentName!=a.agentName&&stragentName.length<1&&(stragentName=a.agentName),stragentName.length>0&&isLogin?$("#TXT_AGENT_NAME").val("Login: "+$("#TXT_AGENT").val()+" - "+stragentName):isLogin&&$("#TXT_AGENT_NAME").val("Login: "+$("#TXT_AGENT").val());var f=a.CanLogin;$("#BT_LOGIN").hide(),"True"==f?$("#BT_LOGIN").show():$("#BT_LOGIN").hide(),"True"==a.CanLogout?$("#BT_LOGOUT").show():$("#BT_LOGOUT").hide(),"True"==a.CanReady?$("#BT_READY").show():$("#BT_READY").hide(),"True"==a.CanPause?($("#pausa-on").show(),$("#pausa-off").hide()):($("#BT_PAUSE").hide(),$("#pausa-on").hide(),$("#pausa-off").show()),"True"==a.CanAnswer?$("#BtAnswerCall").show():$("#BtAnswerCall").hide(),"True"==a.CanHold?($("#BtHold").show(),$("#BtHoldoff").hide()):($("#BtHold").hide(),$("#BtHoldoff").show()),"True"==a.CanRetrieve?($("#BtRetrieve").show(),$("#BtRetrieveoff").hide()):($("#BtRetrieve").hide(),$("#BtRetrieveoff").show()),"True"==a.CanHangup?($("#BtHangup").show(),$("#BtHangupoff").hide()):($("#BtHangup").hide(),$("#BtHangupoff").show());var b=a.CanTransfer;"True"==b?($("#BtTransfer").show(),$("#BtTransferoff").hide()):($("#BtTransfer").hide(),$("#BtTransferoff").show());var c=a.CanConference;"True"==c?($("#BtConference").show(),$("#BtConferenceoff").hide()):($("#BtConference").hide(),$("#BtConferenceoff").show()),"True"==a.CanDial?($("#BtDial").show(),$("#BtDialoff").hide()):($("#BtDial").hide(),$("#BtDialoff").show()),"True"==a.CanCompleteInteraction?($("#BtWrapup").show(),$("#BtWrapupoff").hide()):($("#BtWrapup").hide(),$("#BtWrapupoff").show());var e=a.talkState;"Idle"==e&&(document.getElementById("CallPhoneNumberValue").innerHTML="",document.getElementById("CallCampaignValue").innerHTML="",$("#cti-attendance").hide(),$("#call-duration-count").html("00:00:00"),$("#call-duration-count").hide(),$("#CallState").text("Livre"),timer.stop(),blnscreenpop&&(cti.UpdateTask(currentCreatedTaskId),blnscreenpop=!1),timer.stop(),$("#call-duration-count").html("00:00:00"),$("#call-duration-count").hide(),$("#tempochamada").hide()),"OnCall"==e&&($("#frmDados").show(),$("#cti-attendance").show(),$("#cliente-off").hide(),$("#tempochamada").show(),$("#CallState").text("Ocupado"));var d=a.CallState;"alerting"==d&&api.answer(),"connected"==d&&(callconnected=!0,$("#BT_LOGOUT").prop("disabled",!0));var b=a.CanTransfer;"True"==b?($("#BtTransfer").show(),$("#BtTransferOff").hide()):($("#BtTransfer").hide(),$("#BtTransferOff").show());var c=a.CanConference;if("True"==c?($("#BtConference").show(),$("#BtConferenceOff").hide()):($("#BtConference").hide(),$("#BtConferenceOff").show()),""==d&&(callconnected=!1,$("#BT_LOGOUT").prop("disabled",!1)),a.hasOwnProperty("PauseReason"))for(i in $("#selreason").empty(),strPauseReason=a.PauseReason)$("#selreason").append('<option value="'+strPauseReason[i].id+'">'+strPauseReason[i].reason+"</option>");if(a.hasOwnProperty("MatrizTransf")){for(i in $("#seltransf").empty(),strMatrizTransf=a.MatrizTransf)$("#seltransf").append('<option value="'+strMatrizTransf[i].id+'">'+strMatrizTransf[i].destino+"</option>");$("#seltransf").val("")}switch($("#TXT_AGENT_DISPLAY").html(a.agentState),a.agentState){case"agentNotReady":for(i in strPauseReason)strPauseReason[i].id==a.reasonCode&&(strPause=strPauseReason[i].reason);strPause="Pausa ("+strPause.toLowerCase()+")";break;case"agentReady":strPause="Dispon\xedvel",$("#selreason").val("");break;case"agentNull":case"Logoff":strPause="Deslogado";break;case"agentBusy":strPause="Atendimento";break;default:strPause=a.agentState}strPause+="                                      ",strPause=strPause.substring(0,26),$("#TXT_AGENT_DISPLAY").val(strPause)},$(document).on("click",".btn-ReviewAccount",function(){var a=$(this).data("accountid");sforce.opencti.screenPop({type:sforce.opencti.SCREENPOP_TYPE.SOBJECT,params:{recordId:a}})})