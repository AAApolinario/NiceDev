var _BettaCTI_SDK_API,BettaCTIWS,isInitialize=!1;function getBettaCTIAPI(){return _BettaCTI_SDK_API=new BettaCTISDK,window.addEventListener?addEventListener("message",_BettaCTI_SDK_API.listener,!1):document.attachEvent("onmessage",_BettaCTI_SDK_API.listener),_BettaCTI_SDK_API}var BettaCTISDK=function(){var B,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,C=!1;!function(){this.guid=E();var a=new Object;a.type="newClient",a.guid=B}();var D=new Object;function a(){var a=new Object;a.type="hangup",a.guid=B,F(a)}function E(){function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function A(c){var b=c.data;if(/^[\],:{}\s]*$/.test(b.toString().replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var a=JSON.parse(b);if(a.guid==B)switch(a.type){case"OnHold":void 0!==_BettaCTI_SDK_API.OnHold&&_BettaCTI_SDK_API.OnHold(a);break;case"OnConnectionCleared":void 0!==_BettaCTI_SDK_API.OnConnectionCleared&&_BettaCTI_SDK_API.OnConnectionCleared(a);break;case"OnCallback":void 0!==_BettaCTI_SDK_API.OnCallback&&_BettaCTI_SDK_API.OnCallback(a);break;case"OnRetrieved":void 0!==_BettaCTI_SDK_API.OnRetrieved&&_BettaCTI_SDK_API.OnRetrieved(a);break;case"OnTransferred":void 0!==_BettaCTI_SDK_API.OnTransferred&&_BettaCTI_SDK_API.OnTransferred(a);break;case"OnAnswerCall":void 0!==_BettaCTI_SDK_API.OnAnswerCall&&_BettaCTI_SDK_API.OnAnswerCall(a);break;case"OnAgentReady":void 0!==_BettaCTI_SDK_API.OnAgentReady&&_BettaCTI_SDK_API.OnAgentReady(a);break;case"OnAgentLogged":void 0!==_BettaCTI_SDK_API.OnAgentLogged&&_BettaCTI_SDK_API.OnAgentLogged(a);break;case"OnOriginated":void 0!==_BettaCTI_SDK_API.OnOriginated&&_BettaCTI_SDK_API.OnOriginated(a);break;case"OnFailed":void 0!==_BettaCTI_SDK_API.OnFailed&&_BettaCTI_SDK_API.OnFailed(a);break;case"OnTransferCall":void 0!==_BettaCTI_SDK_API.OnTransferCall&&_BettaCTI_SDK_API.OnTransferCall(a);break;case"OnConsultationCall":void 0!==_BettaCTI_SDK_API.OnConsultationCall&&_BettaCTI_SDK_API.OnConsultationCall(a);break;case"OnMakeCall":void 0!==_BettaCTI_SDK_API.OnMakeCall&&_BettaCTI_SDK_API.OnMakeCall(a);break;case"OnEstablished":void 0!==_BettaCTI_SDK_API.OnEstablished&&_BettaCTI_SDK_API.OnEstablished(a);break;case"OnGetCallInformation":void 0!==_BettaCTI_SDK_API.OnGetCallInformation&&_BettaCTI_SDK_API.OnGetCallInformation(a);break;case"OnDelivered":void 0!==_BettaCTI_SDK_API.OnDelivered&&_BettaCTI_SDK_API.OnDelivered(a);break;case"OnLogout":void 0!==_BettaCTI_SDK_API.OnLogout&&_BettaCTI_SDK_API.OnLogout(a);break;case"OnGetAgentState":void 0!==_BettaCTI_SDK_API.OnGetAgentState&&_BettaCTI_SDK_API.OnGetAgentState(a);break;case"OnWrapup":void 0!==_BettaCTI_SDK_API.OnWrapup&&_BettaCTI_SDK_API.OnWrapup(a);break;case"onBettaCTIOpen":void 0!==_BettaCTI_SDK_API.onBettaCTIOpen&&_BettaCTI_SDK_API.onBettaCTIOpen(a);break;case"onBettaCTIError":void 0!==_BettaCTI_SDK_API.onBettaCTIError&&_BettaCTI_SDK_API.onBettaCTIError(a);break;case"OnAgentNotReady":void 0!==_BettaCTI_SDK_API.OnAgentNotReady&&_BettaCTI_SDK_API.OnAgentNotReady(a);break;case"CSTAErrorCode":void 0!==_BettaCTI_SDK_API.CSTAErrorCode&&_BettaCTI_SDK_API.CSTAErrorCode(a)}else console.log("%% BettaCTISDK %% Not for this client")}}function F(a){BettaCTIWS.send(JSON.stringify(a))}return{login:function(c,d,e,a,f){var b;D.type="login",D.guid=B,D.agentID=c,D.agentPWD=d,D.extension=e,D.instance=f,a.length>0&& !1==isInitialize?(b=a,(BettaCTIWS=new WebSocket(b)).onopen=function(){console.log("onBettaDriverOpen");var a='{"type":"onBettaDriverOpen"}';a=JSON.parse(a),_BettaCTI_SDK_API.onBettaDriverOpen(a),isInitialize=!0},BettaCTIWS.onclose=function(){console.log("onBettaDriverClose"),C=!1,isInitialize=!1;var a='{"type":"onBettaDriverClose"}';a=JSON.parse(a),_BettaCTI_SDK_API.onBettaDriverClose(a)},BettaCTIWS.onerror=function(b){C=!1,isInitialize=!1,console.log("onBettaDriverError");var a='{"type":"onBettaDriverError"}';a=JSON.parse(a),_BettaCTI_SDK_API.onBettaDriverError()},BettaCTIWS.onmessage=function(a){console.log("Received "+a.data),A(a)},BettaCTIWS.addEventListener("error",function(a){console.log("WebSocket error: ",a)}),setTimeout(function(){F(D)},3e3)):F(D)},logout:function(){var a=new Object;a.type="logout",a.guid=B,console.log("Logout"),F(a)},getUserSessionState:function(){var a=new Object;a.type="getUserSessionState",a.guid=B,F(a)},endwrapup:function(){var a=new Object;a.type="endwraup",a.guid=B,a.agentSessionID=agentSessionID,F(a)},conference:function(){var a=new Object;a.type="conference",a.guid=B,F(a)},hold:function(){var a=new Object;a.type="hold",a.guid=B,F(a)},answer:function(){var a=new Object;a.type="answer",a.guid=B,F(a)},transfer:function(){var a=new Object;a.type="transfercall",a.toaddress="",a.guid=B,F(a)},retrieve:function(){var a=new Object;a.type="retrieve",a.guid=B,F(a)},hangup:a,ready:function(){var a=new Object;a.type="ready",a.guid=B,F(a)},pause:function(b){var a=new Object;a.type="pause",a.guid=B,a.reasonID=b,F(a)},hangup:a,makecall:function(b){var a=new Object;a.type="makecall",a.guid=B,a.toaddress=b,F(a)},consultationcall:function(b){var a=new Object;a.type="consultationcall",a.guid=B,a.toaddress=b,F(a)},transfercall:function(b){var a=new Object;a.type="transfercall",a.guid=B,a.toaddress=b,F(a)},callbackstart:function(b){var a=new Object;a.type="callbackstart",a.guid=B,a.toaddress=b,F(a)},callbackcancel:function(b){var a=new Object;a.type="callbackcancel",a.guid=B,a.reason=b,F(a)},listener:A,onBettaCTIOpen:b,onBettaCTIClose:c,onBettaCTIError:d,onUserSessionState:e,OnCallback:f,OnHold:g,OnTransferCall:h,OnConsultationCall:i,OnGetAgentState:j,OnGetCallInformation:k,OnDelivered:m,OnEstablished:l,OnConnectionCleared:n,OnRetrieved:o,OnTransferred:p,OnAnswerCall:q,OnAgentLogged:t,OnAgentReady:r,OnAgentNotReady:s,CSTAErrorCode:z,OnOriginated:u,OnFailed:y,OnMakeCall:v,OnLogout:w,OnWrapup:x}}